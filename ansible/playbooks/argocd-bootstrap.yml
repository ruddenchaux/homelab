---
- name: Configure Cilium L2 load balancing
  hosts: k8s_control_plane
  roles:
    - cilium-l2

- name: Create Authentik secrets
  hosts: k8s_control_plane
  roles:
    - authentik-secrets

- name: Create media secrets
  hosts: k8s_control_plane
  roles:
    - media-secrets

- name: Bootstrap ArgoCD and GitOps
  hosts: k8s_control_plane
  vars_files:
    - "../secrets.sops.yml"
  roles:
    - argocd

- name: Configure Authentik SSO
  hosts: k8s_control_plane
  roles:
    - authentik-config

- name: Configure media stack inter-service connections
  hosts: k8s_control_plane
  tags:
    - media-config
  roles:
    - media-config
